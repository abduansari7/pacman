<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pac-Man Game</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            touch-action: none;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;

        const GRID_SIZE = 20;
        const CELL_SIZE = 25;
        const BASE_PACMAN_SPEED = 100;
        const BASE_GHOST_SPEED = 300;

        const INITIAL_MAZE = [
          [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
          [1,2,2,2,2,2,2,2,2,1,1,2,2,2,2,2,2,2,2,1],
          [1,2,1,1,2,1,1,1,2,1,1,2,1,1,1,2,1,1,2,1],
          [1,3,1,1,2,2,2,2,2,2,2,2,2,2,2,2,1,1,3,1],
          [1,2,2,2,2,1,1,2,1,1,1,1,2,1,1,2,2,2,2,1],
          [1,2,1,1,2,1,1,2,1,1,1,1,2,1,1,2,1,1,2,1],
          [1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],
          [1,2,1,1,2,1,2,1,1,1,1,1,1,2,1,2,1,1,2,1],
          [1,2,2,2,2,1,2,2,2,1,1,2,2,2,1,2,2,2,2,1],
          [1,1,1,1,2,1,1,1,0,1,1,0,1,1,1,2,1,1,1,1],
          [1,1,1,1,2,1,0,0,0,0,0,0,0,0,1,2,1,1,1,1],
          [1,1,1,1,2,1,1,1,1,0,0,1,1,1,1,2,1,1,1,1],
          [1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],
          [1,2,1,1,2,1,1,1,2,1,1,2,1,1,1,2,1,1,2,1],
          [1,3,2,1,2,2,2,2,2,2,2,2,2,2,2,2,1,2,3,1],
          [1,1,2,1,2,1,2,1,1,1,1,1,1,2,1,2,1,2,1,1],
          [1,2,2,2,2,1,2,2,2,1,1,2,2,2,1,2,2,2,2,1],
          [1,2,1,1,1,1,1,1,2,1,1,2,1,1,1,1,1,1,2,1],
          [1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],
          [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
        ];

        const Ghost = ({ className, fill, style }) => (
            <svg viewBox="0 0 24 24" fill={fill} className={className} style={style}>
                <path d="M12 2C8.13 2 5 5.13 5 9v7l-1.5 1.5v2L5 21h14l1.5-1.5v-2L19 16V9c0-3.87-3.13-7-7-7zm-4 9c0-.55.45-1 1-1s1 .45 1 1-.45 1-1 1-1-.45-1-1zm6 0c0-.55.45-1 1-1s1 .45 1 1-.45 1-1 1-1-.45-1-1z"/>
            </svg>
        );

        const ArrowButton = ({ direction, onClick }) => {
          const arrows = {
            up: '‚Üë',
            down: '‚Üì',
            left: '‚Üê',
            right: '‚Üí'
          };
          
          return (
            <button
              onMouseDown={onClick}
              onTouchStart={(e) => {
                e.preventDefault();
                onClick();
              }}
              className="bg-blue-600 hover:bg-blue-700 active:bg-blue-800 text-white font-bold text-3xl w-16 h-16 rounded-lg shadow-lg"
            >
              {arrows[direction]}
            </button>
          );
        };

        function PacmanGame() {
          const [gameState, setGameState] = useState('menu');
          const [level, setLevel] = useState(1);
          const [pacman, setPacman] = useState({ x: 1, y: 1 });
          const [ghosts, setGhosts] = useState([
            { x: 9, y: 9, color: 'red' },
            { x: 10, y: 9, color: 'pink' },
            { x: 9, y: 10, color: 'cyan' }
          ]);
          const [maze, setMaze] = useState(INITIAL_MAZE);
          const [score, setScore] = useState(0);
          const [powerMode, setPowerMode] = useState(false);
          const [direction, setDirection] = useState({ x: 0, y: 0 });

          const pacmanSpeed = BASE_PACMAN_SPEED * (1 + (level - 1) * 0.005);
          const ghostSpeed = BASE_GHOST_SPEED * (1 - (level - 1) * 0.15);

          const canMove = (x, y) => {
            return x >= 0 && x < GRID_SIZE && y >= 0 && y < GRID_SIZE && maze[y][x] !== 1;
          };

          const checkLevelComplete = () => {
            let hasDotsLeft = false;
            for (let row of maze) {
              for (let cell of row) {
                if (cell === 2 || cell === 3) {
                  hasDotsLeft = true;
                  break;
                }
              }
              if (hasDotsLeft) break;
            }
            
            if (!hasDotsLeft && gameState === 'playing') {
              if (level === 3) {
                setGameState('gameWon');
              } else {
                setGameState('levelComplete');
              }
            }
          };

          const movePacman = useCallback(() => {
            if (gameState !== 'playing' || (direction.x === 0 && direction.y === 0)) return;

            const newX = pacman.x + direction.x;
            const newY = pacman.y + direction.y;

            if (canMove(newX, newY)) {
              const cell = maze[newY][newX];
              
              if (cell === 2) {
                setScore(s => s + 10);
                const newMaze = maze.map(row => [...row]);
                newMaze[newY][newX] = 0;
                setMaze(newMaze);
              } else if (cell === 3) {
                setScore(s => s + 50);
                setPowerMode(true);
                const newMaze = maze.map(row => [...row]);
                newMaze[newY][newX] = 0;
                setMaze(newMaze);
                setTimeout(() => setPowerMode(false), 5000);
              }

              setPacman({ x: newX, y: newY });
            }
          }, [pacman, direction, maze, gameState]);

          const moveGhosts = useCallback(() => {
            if (gameState !== 'playing') return;

            setGhosts(prevGhosts => prevGhosts.map(ghost => {
              const directions = [
                { x: 0, y: -1 },
                { x: 0, y: 1 },
                { x: -1, y: 0 },
                { x: 1, y: 0 }
              ];

              if (powerMode) {
                const validMoves = directions.filter(d => 
                  canMove(ghost.x + d.x, ghost.y + d.y)
                );
                const randomDir = validMoves[Math.floor(Math.random() * validMoves.length)];
                if (randomDir) {
                  return { ...ghost, x: ghost.x + randomDir.x, y: ghost.y + randomDir.y };
                }
              } else {
                const dx = pacman.x - ghost.x;
                const dy = pacman.y - ghost.y;
                
                let preferredDirs = [];
                if (Math.abs(dx) > Math.abs(dy)) {
                  preferredDirs = dx > 0 ? [{ x: 1, y: 0 }] : [{ x: -1, y: 0 }];
                } else {
                  preferredDirs = dy > 0 ? [{ x: 0, y: 1 }] : [{ x: 0, y: -1 }];
                }

                for (let dir of preferredDirs) {
                  if (canMove(ghost.x + dir.x, ghost.y + dir.y)) {
                    return { ...ghost, x: ghost.x + dir.x, y: ghost.y + dir.y };
                  }
                }

                const validMoves = directions.filter(d => 
                  canMove(ghost.x + d.x, ghost.y + d.y)
                );
                const randomDir = validMoves[Math.floor(Math.random() * validMoves.length)];
                if (randomDir) {
                  return { ...ghost, x: ghost.x + randomDir.x, y: ghost.y + randomDir.y };
                }
              }

              return ghost;
            }));
          }, [pacman, powerMode, gameState, maze]);

          useEffect(() => {
            checkLevelComplete();
          }, [maze]);

          useEffect(() => {
            ghosts.forEach(ghost => {
              if (ghost.x === pacman.x && ghost.y === pacman.y && gameState === 'playing') {
                if (powerMode) {
                  setScore(s => s + 200);
                  setGhosts(g => g.filter(g => !(g.x === ghost.x && g.y === ghost.y)));
                } else {
                  setGameState('gameOver');
                }
              }
            });
          }, [pacman, ghosts, powerMode, gameState]);

          useEffect(() => {
            const handleKeyPress = (e) => {
              if (gameState !== 'playing') return;
              e.preventDefault();
              switch(e.key) {
                case 'ArrowUp':
                  setDirection({ x: 0, y: -1 });
                  break;
                case 'ArrowDown':
                  setDirection({ x: 0, y: 1 });
                  break;
                case 'ArrowLeft':
                  setDirection({ x: -1, y: 0 });
                  break;
                case 'ArrowRight':
                  setDirection({ x: 1, y: 0 });
                  break;
              }
            };

            window.addEventListener('keydown', handleKeyPress);
            return () => window.removeEventListener('keydown', handleKeyPress);
          }, [gameState]);

          useEffect(() => {
            const gameInterval = setInterval(() => {
              movePacman();
            }, pacmanSpeed);

            return () => clearInterval(gameInterval);
          }, [movePacman, pacmanSpeed]);

          useEffect(() => {
            const ghostInterval = setInterval(() => {
              moveGhosts();
            }, ghostSpeed);

            return () => clearInterval(ghostInterval);
          }, [moveGhosts, ghostSpeed]);

          const startGame = () => {
            setPacman({ x: 1, y: 1 });
            setGhosts([
              { x: 9, y: 9, color: 'red' },
              { x: 10, y: 9, color: 'pink' },
              { x: 9, y: 10, color: 'cyan' }
            ]);
            setMaze(INITIAL_MAZE);
            setScore(0);
            setPowerMode(false);
            setDirection({ x: 0, y: 0 });
            setLevel(1);
            setGameState('playing');
          };

          const nextLevel = () => {
            setPacman({ x: 1, y: 1 });
            setGhosts([
              { x: 9, y: 9, color: 'red' },
              { x: 10, y: 9, color: 'pink' },
              { x: 9, y: 10, color: 'cyan' }
            ]);
            setMaze(INITIAL_MAZE);
            setPowerMode(false);
            setDirection({ x: 0, y: 0 });
            setLevel(level + 1);
            setGameState('playing');
          };

          const quitGame = () => {
            setGameState('menu');
            setLevel(1);
            setScore(0);
          };

          const handleDirectionButton = (dir) => {
            if (gameState !== 'playing') return;
            setDirection(dir);
          };

          if (gameState === 'menu') {
            return (
              <div className="flex flex-col items-center justify-center min-h-screen bg-gray-900 p-4">
                <h1 className="text-6xl font-bold text-yellow-400 mb-8">PAC-MAN</h1>
                <div className="text-white text-center mb-8 max-w-md">
                  <p className="mb-4">Complete 3 levels to win!</p>
                  <p className="mb-4">Each level gets harder - ghosts get faster and Pac-Man gets slower.</p>
                  <p className="text-sm text-gray-400">Use arrow keys or on-screen buttons to move</p>
                </div>
                <button
                  onClick={startGame}
                  className="bg-yellow-400 hover:bg-yellow-500 text-gray-900 font-bold text-2xl px-12 py-6 rounded-lg shadow-lg"
                >
                  PLAY GAME
                </button>
              </div>
            );
          }

          return (
            <div className="flex flex-col items-center justify-center min-h-screen bg-gray-900 p-4">
              <div className="mb-4 text-white text-2xl font-bold">
                Level: {level} | Score: {score}
                {powerMode && <span className="ml-4 text-yellow-400">POWER MODE!</span>}
              </div>
              
              <div 
                className="relative bg-black border-4 border-blue-600 mb-4"
                style={{ 
                  width: GRID_SIZE * CELL_SIZE, 
                  height: GRID_SIZE * CELL_SIZE 
                }}
              >
                {maze.map((row, y) => 
                  row.map((cell, x) => (
                    <div
                      key={`${x}-${y}`}
                      className="absolute"
                      style={{
                        left: x * CELL_SIZE,
                        top: y * CELL_SIZE,
                        width: CELL_SIZE,
                        height: CELL_SIZE
                      }}
                    >
                      {cell === 1 && <div className="w-full h-full bg-blue-600" />}
                      {cell === 2 && (
                        <div className="w-full h-full flex items-center justify-center">
                          <div className="w-2 h-2 bg-yellow-200 rounded-full" />
                        </div>
                      )}
                      {cell === 3 && (
                        <div className="w-full h-full flex items-center justify-center">
                          <div className="w-3 h-3 bg-yellow-400 rounded-full" />
                        </div>
                      )}
                    </div>
                  ))
                )}

                <div
                  className="absolute transition-all duration-100"
                  style={{
                    left: pacman.x * CELL_SIZE,
                    top: pacman.y * CELL_SIZE,
                    width: CELL_SIZE,
                    height: CELL_SIZE
                  }}
                >
                  <div className="w-full h-full bg-yellow-400 rounded-full flex items-center justify-center text-xl">
                    üü°
                  </div>
                </div>

                {ghosts.map((ghost, i) => (
                  <Ghost
                    key={i}
                    className="absolute transition-all duration-150"
                    fill={powerMode ? '#6366f1' : ghost.color}
                    style={{
                      left: ghost.x * CELL_SIZE,
                      top: ghost.y * CELL_SIZE,
                      width: CELL_SIZE,
                      height: CELL_SIZE
                    }}
                  />
                ))}

                {gameState === 'levelComplete' && (
                  <div className="absolute inset-0 bg-black bg-opacity-90 flex items-center justify-center">
                    <div className="text-center">
                      <div className="text-green-400 text-4xl font-bold mb-4">GREAT JOB!</div>
                      <div className="text-white text-2xl mb-2">Level {level} Complete!</div>
                      <div className="text-white text-xl mb-6">Score: {score}</div>
                      <div className="flex gap-4">
                        <button
                          onClick={nextLevel}
                          className="bg-green-600 text-white px-8 py-4 rounded-lg font-bold hover:bg-green-700 text-xl"
                        >
                          Continue
                        </button>
                        <button
                          onClick={quitGame}
                          className="bg-red-600 text-white px-8 py-4 rounded-lg font-bold hover:bg-red-700 text-xl"
                        >
                          Quit
                        </button>
                      </div>
                    </div>
                  </div>
                )}

                {gameState === 'gameWon' && (
                  <div className="absolute inset-0 bg-black bg-opacity-90 flex items-center justify-center">
                    <div className="text-center">
                      <div className="text-yellow-400 text-5xl font-bold mb-4">üéâ YOU WON! üéâ</div>
                      <div className="text-white text-3xl mb-2">All Levels Complete!</div>
                      <div className="text-white text-2xl mb-6">Final Score: {score}</div>
                      <button
                        onClick={quitGame}
                        className="bg-yellow-400 text-gray-900 px-8 py-4 rounded-lg font-bold hover:bg-yellow-500 text-xl"
                      >
                        Back to Menu
                      </button>
                    </div>
                  </div>
                )}

                {gameState === 'gameOver' && (
                  <div className="absolute inset-0 bg-black bg-opacity-90 flex items-center justify-center">
                    <div className="text-center">
                      <div className="text-red-500 text-4xl font-bold mb-4">GAME OVER</div>
                      <div className="text-white text-2xl mb-6">Final Score: {score}</div>
                      <div className="flex gap-4">
                        <button
                          onClick={startGame}
                          className="bg-blue-600 text-white px-8 py-4 rounded-lg font-bold hover:bg-blue-700 text-xl"
                        >
                          Try Again
                        </button>
                        <button
                          onClick={quitGame}
                          className="bg-red-600 text-white px-8 py-4 rounded-lg font-bold hover:bg-red-700 text-xl"
                        >
                          Quit
                        </button>
                      </div>
                    </div>
                  </div>
                )}
              </div>

              <div className="grid grid-cols-3 gap-2 mb-4">
                <div></div>
                <ArrowButton direction="up" onClick={() => handleDirectionButton({ x: 0, y: -1 })} />
                <div></div>
                <ArrowButton direction="left" onClick={() => handleDirectionButton({ x: -1, y: 0 })} />
                <ArrowButton direction="down" onClick={() => handleDirectionButton({ x: 0, y: 1 })} />
                <ArrowButton direction="right" onClick={() => handleDirectionButton({ x: 1, y: 0 })} />
              </div>

              <div className="text-white text-center">
                <div className="text-sm text-gray-400">
                  Eat all dots to complete the level ‚Ä¢ Avoid ghosts ‚Ä¢ Power pellets let you eat ghosts!
                </div>
              </div>
            </div>
          );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<PacmanGame />);
    </script>
</body>
</html>
